{{- if not (.Page.Scratch.Get "hasChartJS") -}}
<script src="https://cdn.jsdelivr.net/npm/patternomaly@1.3.2/dist/patternomaly.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Default light theme colors
Chart.defaults.color = '#000';
Chart.defaults.scale.grid.color = 'rgba(0, 0, 0, 0.1)';

function updateChartTheme(isDark) {
  if (isDark) {
    Chart.defaults.color = '#fff';
    Chart.defaults.scale.grid.color = 'rgba(255, 255, 255, 0.1)';
  } else {
    Chart.defaults.color = '#000';
    Chart.defaults.scale.grid.color = 'rgba(0, 0, 0, 0.1)';
  }
}

// Check initial theme
if (localStorage.getItem("pref-theme") == "dark") {
  updateChartTheme(true);
} else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
  updateChartTheme(true);
}

// Listen for theme changes
window.addEventListener('storage', function(e) {
  if (e.key === 'pref-theme') {
    updateChartTheme(e.newValue === 'dark');
  }
});

// Listen for system preference changes
window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
  if (!localStorage.getItem("pref-theme")) {
    updateChartTheme(e.matches);
  }
});
</script>
{{- .Page.Scratch.Set "hasChartJS" true -}}
{{- end -}}
{{- $id := substr (md5 .Inner) 0 16 -}}
<div class="chart">
<canvas id="{{ $id }}"></canvas>
</div>
<script>
document.addEventListener('DOMContentLoaded', () => {
  var ctx = document.getElementById('{{ $id }}');
  var options = {{ .Inner | chomp | safeJS }};
  new Chart(ctx, options);
});
</script>